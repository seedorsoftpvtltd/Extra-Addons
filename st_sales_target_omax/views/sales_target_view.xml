<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Sales Target +++++++++++++++++++++++++++++++++++++++++++ -->
    <!-- SalesTeam Target Form View -->
    <record id="salesteam_target_view_form_omax" model="ir.ui.view">
        <field name="name">sales.team.target.form</field>
        <field name="model">sales.team.target</field>
        <field name="arch" type="xml">
            <form string="SalesTeam Target">
                <header>
                    <button name="action_confirm" type="object" string="Confirm" class="oe_highlight" 
                            attrs="{'invisible': [('state', '!=', 'draft')]}" groups="sales_team.group_sale_manager"/>
                    <button name="action_close" type="object" string="Close" class="oe_highlight" 
                            attrs="{'invisible': [('state', '!=', 'open')]}" groups="sales_team.group_sale_manager"/>
                    <button name="action_calcel" type="object" string="Cancel" attrs="{'invisible': [('state', '!=', 'close')]}" groups="sales_team.group_sale_manager"/>
                    <button name="action_send_mail" string="Send Mail" class="btn-primary" type="object" attrs="{'invisible': [('state', 'in', ('draft','cancel'))]}" groups="sales_team.group_sale_manager"/>
                            
                    <field name="state" widget="statusbar" statusbar_visible="draft,open,closed"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group>
                        <group name="left">
                            <field name="salesteam_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="start_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="end_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="responsible_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                        <group name="right">
                            <field name="target_point" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="target_amount" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="achivement_amount"/>
                            <field name="difference_amount"/>
                            <field name="achivement_per" widget="progressbar"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Sales Order" name="sales_order" attrs="{'invisible': [('target_point','!=','sale_confirm')]}">
                            <field name="sale_order_ids" nolabel="1" readonly="1">
                                <tree>
                                    <field name="name" string="Order Number" readonly="1"/>
                                    <field name="date_order" string="Order Date"/>
                                    <field name="commitment_date"/>
                                    <field name="expected_date"/>
                                    <field name="partner_id" readonly="1"/>
                                    <field name="user_id" optional="show"/>
                                    <field name="team_id" optional="hide"/>
                                    <field name="company_id" groups="base.group_multi_company" optional="show" readonly="1"/>
                                    <field name="amount_untaxed" sum="Total Tax Excluded" widget="monetary" optional="hide"/>
                                    <field name="amount_tax" sum="Tax Total" widget="monetary" optional="hide"/>
                                    <field name="amount_total" sum="Total Tax Included" widget="monetary" optional="show"/>
                                    <field name="currency_id" invisible="1"/>
                                    <field name="invoice_status" optional="show"/>
                                    <field name="state" invisible="1"/>
                                    <field name="activity_exception_decoration" widget="activity_exception"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Invoices" name="invoices" attrs="{'invisible': [('target_point','=','sale_confirm')]}">
                            <field name="move_ids" nolabel="1" readonly="1">
                                <tree>
                                    <field name="name"/>
                                    <field name="partner_id" invisible="1"/>
                                    <field name="invoice_source_email" invisible="1"/>
                                    <field name="invoice_partner_icon" string=" "/>
                                    <field name="invoice_partner_display_name" invisible="context.get('default_type') not in ('in_invoice', 'in_refund','in_receipt')" groups="base.group_user" string="Vendor"/>
                                    <field name="invoice_partner_display_name" invisible="context.get('default_type') not in ('out_invoice', 'out_refund','out_receipt')" groups="base.group_user" string="Customer"/>
                                    <field name="invoice_date" optional="show" invisible="context.get('default_type') not in ('in_invoice', 'in_refund','in_receipt')" string="Bill Date"/>
                                    <field name="invoice_date" optional="show" invisible="context.get('default_type') not in ('out_invoice', 'out_refund','out_receipt')" string="Invoice Date"/>
                                    <field name="invoice_origin" optional="show" string="Source Document"/>
                                    <field name="invoice_payment_ref" optional="hide" invisible="context.get('default_type') in ('out_invoice', 'out_refund','out_receipt')"/>
                                    <field name="invoice_user_id" optional="show" invisible="context.get('default_type') not in ('out_invoice', 'out_refund','out_receipt')" string="Sales Person"/>
                                    <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" optional="show"/>
                                    <field name="invoice_date_due" optional="show"/>
                                    <field name="amount_untaxed_signed" string="Tax Excluded" sum="Total" optional="show"/>
                                    <field name="amount_tax_signed" string="Tax" sum="Total" optional="hide"/>
                                    <field name="amount_total_signed" string="Total" sum="Total" optional="show"/>
                                    <field name="amount_residual_signed" string="Amount Due" sum="Amount Due" optional="show"/>
                                    <field name="currency_id" invisible="1"/>
                                    <field name="company_currency_id" invisible="1"/>
                                    <field name="state" optional="show"/>
                                    <field name="invoice_payment_state" optional="hide"/>
                                    <field name="type" invisible="context.get('default_type', True)"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" help="Follow this salesteam to automatically track the events associated to users of this team."/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Sales Teams Tree View -->
    <record id="salesteam_target_view_tree_omax" model="ir.ui.view">
        <field name="name">sales.team.target.tree</field>
        <field name="model">sales.team.target</field>
        <field name="priority">1</field>
        <field name="arch" type="xml">
            <tree string="SalesTeam Sales Target" name="sales_target_tree">
                <field name="name"/>
                <field name="salesteam_id"/>
                <field name="responsible_id"/>
                <field name="target_point"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="target_amount"/>
                <field name="achivement_amount"/>
                <field name="achivement_per" widget="progressbar"/>
                <field name="state"/>
            </tree>
        </field>
    </record>
    
    <!-- Sales Team Target Kanban View  -->
    <record model="ir.ui.view" id="view_salesteam_target_kanban_omax">
        <field name="name">sales.team.target.kanban</field>
        <field name="model">sales.team.target</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile">
                <field name="name"/>
                <field name="salesteam_id"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="target_amount"/>
                <field name="achivement_amount"/>
                <field name="achivement_per"/>
                <field name="state"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_record_top mb16">
                                <div class="o_kanban_record_headings mt4">
                                    <strong>
                                        <span><t t-esc="record.name.value"/></span><br/>
                                        <span><t t-esc="record.salesteam_id.value"/></span><br/>
                                        <span><t t-esc="record.start_date.value"/> - <t t-esc="record.end_date.value"/></span>
                                    </strong>
                                </div>
                                <strong>
                                    Target : <span><t t-esc="record.target_amount.value"/></span><br/>
                                    Achivement : <span><t t-esc="record.achivement_amount.value"/></span><br/>
                                    Achivement Per.: <span><t t-esc="record.achivement_per.value"/></span> %<br/>
                                </strong>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_right">
                                    <field name="state" widget="label_selection" options="{'classes': {'draft': 'default', 'cancel': 'default', 'closed': 'success', 'open': 'success'}}"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <!-- Sales Team Target Search View -->
    <record id="salesteam_target_search_omax" model="ir.ui.view">
        <field name="name">Sales Team Target - Search</field>
        <field name="model">sales.team.target</field>
        <field name="arch" type="xml">
            <search string="Sales Target Search">
                <field name="name"/>
                <field name="salesteam_id"/>
                <field name="responsible_id"/>
                <field name="target_amount"/>
                <field name="achivement_amount"/>
                <field name="achivement_per"/>
                <field name="state"/>
                <group expand="0" string="Group By...">
                    <filter string="SalesTeam" name="sales_team" domain="[]" context="{'group_by':'salesteam_id'}"/>
                    <filter string="Responsible" name="responsible" domain="[]" context="{'group_by':'responsible_id'}"/>
                    <filter string="Status" name="status" domain="[]" context="{'group_by':'state'}"/>
                    <filter string="Target Point" name="target_point" domain="[]" context="{'group_by':'target_point'}"/>
                </group>
            </search>
        </field>
    </record>
    <!-- Sales Team Target Action View -->
    <record id="salesteam_target_action_omax" model="ir.actions.act_window">
        <field name="name">SalesTeam Sales Target</field>
        <field name="res_model">sales.team.target</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="context">{}</field>
        <field name="view_id" ref="salesteam_target_search_omax"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Define a new sales target for salesperson
            </p><p>
                Use Sales Teams to organize your sales departments.
                Each team will work with a separate pipeline.
            </p>
        </field>
    </record>
    
    <!-- Sales Target Menu View -->
    <menuitem id="menu_sale_target_root"
            name="Sales Target"
            parent="sale.sale_menu_root"
            sequence="5"
            groups="sales_team.group_sale_salesman"/>
            
    <menuitem id="salesteam_target_menu_omax"
            name="SalesTeam Sales Target"
            parent="menu_sale_target_root"
            action="salesteam_target_action_omax"
            sequence="2"
            groups="sales_team.group_sale_salesman"/>
    
</odoo>
