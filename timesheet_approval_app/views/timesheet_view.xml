<?xml version="1.0"?>
<odoo>

	<record id="view_order_timesheet" model="ir.ui.view">
	    <field name="name">timesheet.order</field>
	    <field name="model">account.analytic.line</field>
	    <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_form"/>
	    <field name="arch" type="xml">
	    	<xpath expr="//form/sheet" position="before">
		    	<header>
	                <button name="submit_to_manager" string="Submit To Manager" states="draft" class="oe_highlight" type="object" />
	                <button name="approve_by_manager" string="Approve" class="oe_highlight" states="submitted" type="object" groups="hr_timesheet.group_timesheet_manager" />
                    <button name="%(action_confirm1)d" string="Rejected" class="oe_highlight" states="submitted" type="action" groups="hr_timesheet.group_timesheet_manager" />
                    <button name="set_to_draft" string="Set To Draft" class="oe_highlight" type="object" states="reject" />
                    <field name="state" widget="statusbar" statusbar_visible="draft,submitted,approve,reject"/>
	            </header>
        	</xpath>
            <xpath expr="//form/sheet" position="after">
                <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" />
                        <field name="message_ids" widget="mail_thread"/>
                </div>
            </xpath>
	    	<xpath expr="//field[@name='name']" position="after">
                <field name="approved_by_id" attrs="{'readonly':[('state','!=','draft')]}"/>
                <field name="approved_date" attrs="{'readonly':[('state','!=','draft')]}"/>
            </xpath>
            <xpath expr="//field[@name='unit_amount']" position="after">
                <field name="rejected_by_id" attrs="{'readonly':[('state','!=','draft')]}"/>
                <field name="rejected_reason" attrs="{'readonly':[('state','!=','draft')]}"/>
                <field name="rejected_date" attrs="{'readonly':[('state','!=','draft')]}"/>
            </xpath>
        </field>
    </record>

    <!-- Override Timesheet Tree View -->
    <record id="hr_timesheet.hr_timesheet_line_tree" model="ir.ui.view">
        <field name="name">account.analytic.line.tree.hr_timesheet</field>
        <field name="model">account.analytic.line</field>
        <field name="arch" type="xml">
            <tree string="Timesheet Activities">
                <field name="date"/>
                <field name="name"/>
                <field name="employee_id"/>
                <field name="project_id" required="1"/>
                <field name="task_id" context="{'default_project_id': project_id}" domain="[('project_id', '=', project_id)]"/>
                <field name="unit_amount" widget="timesheet_uom" sum="Total"/>
                <field name="state"/>
                <button name="approve_by_manager" string="Approve" class="oe_highlight" type="object" attrs="{'invisible':[('state','!=','submitted')]}" groups="hr_timesheet.group_timesheet_manager"/>
                <button name="%(action_confirm1)d" string="Rejected" class="oe_highlight" type="action" attrs="{'invisible':[('state','!=','submitted')]}" groups="hr_timesheet.group_timesheet_manager"/>
                <button name="set_to_draft" string="Set To Draft" class="oe_highlight" type="object" attrs="{'invisible':[('state','!=','reject')]}" />
            </tree>
        </field>
    </record>

    <record id="action_to_approve_timesheet" model="ir.actions.act_window">
        <field name="name">To Approve Timesheet</field>
        <field name="res_model">account.analytic.line</field>
        <field name="view_mode">form</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="view_id" ref="hr_timesheet.hr_timesheet_line_tree"/>
        <field name="domain">[('state', '=', 'submitted')]</field>
    </record>

    <record id="action_to_approve_timesheet_tree" model="ir.actions.act_window.view">
        <field name="view_mode">tree</field>
        <field name="sequence">1</field>
        <field name="view_id" ref="hr_timesheet.hr_timesheet_line_tree"/>
        <field name="act_window_id" ref="action_to_approve_timesheet"/>
    </record>

    <record id="action_to_approve_timesheet_form" model="ir.actions.act_window.view">
        <field name="view_mode">form</field>
        <field name="sequence">2</field>
        <field name="view_id" ref="hr_timesheet.hr_timesheet_line_form"/>
        <field name="act_window_id" ref="action_to_approve_timesheet"/>
    </record>

    <record id="action_to_approve_timesheet_kanban" model="ir.actions.act_window.view">
        <field name="view_mode">kanban</field>
        <field name="sequence">3</field>
        <field name="view_id" ref="hr_timesheet.view_kanban_account_analytic_line"/>
        <field name="act_window_id" ref="action_to_approve_timesheet"/>
    </record>

    <menuitem id="menu_new_hr"
        name="To Approve Timesheet"
        parent="hr_timesheet.timesheet_menu_root" 
        action="action_to_approve_timesheet"/>

    <act_window
        name="Approved"
        res_model="approve.wizard"
        binding_model="account.analytic.line"
        binding_views="list"
        view_mode="form"
        target="new"
        id="action_account_payment_from_approve"
        groups="hr_timesheet.group_timesheet_manager"
        />
    <act_window
        name="Rejected"
        res_model="reject.wizard"
        binding_model="account.analytic.line"
        binding_views="list"
        view_mode="form"
        target="new"
        id="action_account_payment_from_reject"
        groups="hr_timesheet.group_timesheet_manager"
        />


    <!-- Override My Timesheet Action -->

    <record id="hr_timesheet.act_hr_timesheet_line" model="ir.actions.act_window">
        <field name="name">My Timesheets</field>
        <field name="res_model">account.analytic.line</field>
        <field name="view_mode">form</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="domain">[('project_id', '!=', False), ('user_id', '=', uid)]</field>
        <field name="context">{
            "search_default_week":1,
        }</field>
        <field name="search_view_id" ref="hr_timesheet.hr_timesheet_line_search"/>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Record a new activity
          </p><p>
            You can register and track your workings hours by project every
            day. Every time spent on a project will become a cost and can be re-invoiced to
            customers if required.
          </p>
        </field>
    </record>

    <!-- Override All Timesheet Action -->

    <record id="hr_timesheet.timesheet_action_all" model="ir.actions.act_window">
        <field name="name">All Timesheets</field>
        <field name="res_model">account.analytic.line</field>
        <field name="view_mode">form</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="search_view_id" ref="hr_timesheet.hr_timesheet_line_search"/>
        <field name="domain">[('project_id', '!=', False)]</field>
        <field name="context">{
            'search_default_week':1,
            'search_default_groupby_employee':1,
            'search_default_groupby_project':1,
            'search_default_groupby_task':1,
        }</field>
    </record>

</odoo>
